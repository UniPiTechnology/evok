image: $CI_REGISTRY/docker/bob-the-builder:latest

before_script:
        - apt update
        - apt install -y dh-virtualenv dpkg-dev dh-exec build-essential fakeroot git
          # one-liner to generate Debian changelog from last 10 commit messages
        - git log -10 --date="format:%Y%m%d%H%M%S" --pretty="evok (%ad) unstable; urgency=medium%n%n  * %s%n%n -- %an <%ae>  %aD %n" > debian/changelog 

build_on_rpi:
        tags:
                - armhf
        script:
                - dpkg-buildpackage -us -uc
                - mkdir build
                - mv ../evok_`git log -1  --date="format:%Y%m%d%H%M%S" --pretty="%ad"`* build/
        artifacts:
                paths:
                        - build/*
                        - debian/changelog

build_on_nanopi:
        tags:
                - arm64
        script:
                - dpkg-buildpackage -us -uc
                - mkdir build
                - mv ../evok_`git log -1  --date="format:%Y%m%d%H%M%S" --pretty="%ad"`* build/
        artifacts:
                paths:
                        - build/*
                        - debian/changelog
